<div [formGroup]="form" class="p-3">
  <!-- Index Pattern -->
  <div class="mb-3">
    <label for="indexPattern" class="form-label">Index Pattern:</label>
    <input id="indexPattern" formControlName="indexPattern" class="form-control" placeholder="e.g. logs-*" />
  </div>

  <!-- WITH expressions -->
  <div formArrayName="with" class="mb-4">
    <label class="form-label">Expressions (AND):</label>
    <div *ngFor="let expr of with.controls; let j = index" [formGroupName]="j" class="row g-2 mb-2 align-items-end">
      <div class="col-md-3">
        <input formControlName="field" class="form-control" placeholder="Field" />
      </div>
      <div class="col-md-3">
        <input formControlName="operator" class="form-control" placeholder="Operator" />
      </div>
      <div class="col-md-4">
        <input formControlName="value" class="form-control" placeholder="Value" />
      </div>
      <div class="col-md-2">
        <button type="button" class="btn btn-outline-danger w-100" (click)="removeExpression(j)">Remove</button>
      </div>
    </div>
    <button type="button" class="btn btn-outline-primary" (click)="addExpression()">Add Expression</button>
  </div>

  <!-- OR nested SearchRequests -->
  <div formArrayName="or" class="mb-4">
    <label class="form-label">OR (nested SearchRequests):</label>
    <div *ngFor="let nested of or.controls; let k = index">
      <fieldset class="form-fieldset border p-3">
        <legend>
          <label>After events</label>
          <span class="span-small-icon ml-2">
                  <i (click)="addOr()"
                     class="icon-plus2 mr-1 cursor-pointer"
                     ngbTooltip="Add after event">
                  </i>
              </span>
        </legend>
        <app-after-event
          [form]="asFormGroup(or.at(k))"
          (remove)="removeOr(k)">
        </app-after-event>
      </fieldset>
    </div>
    <button *ngIf="or.controls.length === 0" type="button" class="btn btn-outline-secondary" (click)="addOr()">Add Nested SearchRequest</button>
  </div>

  <!-- Remove this SearchRequest -->
  <div class="text-end">
    <button type="button" class="btn btn-danger" (click)="remove.emit()">Remove This</button>
  </div>
</div>

